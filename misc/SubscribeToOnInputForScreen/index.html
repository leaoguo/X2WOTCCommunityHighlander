<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>SubscribeToOnInputForScreen - X2WOTCCommunityHighlander</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "SubscribeToOnInputForScreen";
    var mkdocs_page_input_path = "misc/SubscribeToOnInputForScreen.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ini.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/unrealscript.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> X2WOTCCommunityHighlander</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">X2WOTCCommunityHighlander Documentation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Bugfixes/">Bugfixes</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../compatibility/">Compatibility</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../customization/">Customization</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../dlc2/">Dlc2</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../events/">Events</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../loadoutslots/">Loadout Slots</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../pawns/">Pawns</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../ui/">User Interface</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Misc</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../ArmorEquipRollDLCPartChance/">ArmorEquipRollDLCPartChance</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../CHEventListenerTemplate/">CHEventListenerTemplate</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ChangeDefaultWeaponColor/">ChangeDefaultWeaponColor</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ClassIsNative/">ClassIsNative</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ComponentVersions/">ComponentVersions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../CustomInventorySlots/">CustomInventorySlots</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../DLCAppendWeaponSockets/">DLCAppendWeaponSockets</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../DebugStartSecondWave/">DebugStartSecondWave</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../SubscribeToOnInput/">SubscribeToOnInput</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">SubscribeToOnInputForScreen</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../TintMaterialConfigs/">TintMaterialConfigs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../UpdateHumanPawnMeshComponent/">UpdateHumanPawnMeshComponent</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../UpdateHumanPawnMeshMaterial/">UpdateHumanPawnMeshMaterial</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../XComLWTuple/">XComLWTuple</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Strategy</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/CovertAction_OverrideCostScalar/">CovertAction_OverrideCostScalar</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/CovertAction_OverrideRewardScalar/">CovertAction_OverrideRewardScalar</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/FirstPromotionOverrideClass/">FirstPromotionOverrideClass</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/OnBestGearLoadoutApplied/">OnBestGearLoadoutApplied</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/OverrideDarkEventCount/">OverrideDarkEventCount</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/OverrideHasAmmoPocket/">OverrideHasAmmoPocket</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/OverrideHasExtraUtilitySlot/">OverrideHasExtraUtilitySlot</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/OverrideHasGrenadePocket/">OverrideHasGrenadePocket</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/OverrideNextRetaliationDisplay/">OverrideNextRetaliationDisplay</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/PreCompleteStrategyFromTacticalTransfer/">PreCompleteStrategyFromTacticalTransfer</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/PreDarkEventDeactivated/">PreDarkEventDeactivated</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/ShowItemInLockerList/">ShowItemInLockerList</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../strategy/ValidateGTSClassTraining/">ValidateGTSClassTraining</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tactical</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/DamageCalc_ArmorBeforeShield/">DamageCalc_ArmorBeforeShield</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/DisplayCustomOverwatchActionPointOnUnitFlag/">DisplayCustomOverwatchActionPointOnUnitFlag</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/OverKillDamage/">OverKillDamage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/OverrideHasInfiniteAmmo/">OverrideHasInfiniteAmmo</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/OverrideHitEffects/">OverrideHitEffects</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/OverrideProjectileInstance/">OverrideProjectileInstance</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/OverrideUnitFocusUI/">OverrideUnitFocusUI</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tactical/PostAliensSpawned/">PostAliensSpawned</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">X2WOTCCommunityHighlander</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Misc &raquo;</li>
        
      
    
    <li>SubscribeToOnInputForScreen</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1>SubscribeToOnInputForScreen</h1>

<p>Tracking Issue: <a href="https://github.com/X2CommunityCore/X2WOTCCommunityHighlander/issues/501">#501</a></p>
<p>Tags: <a href="../../ui/">ui</a></p>
<p>Mods may want to intercept mouse/keyboard/controller input on certain screens and instead run their own code.
For example, the Highlander adds a text to the main menu that has small pop-up accessible
by pressing the right controller stick.</p>
<p>The API consists of a delegate definition and two functions:</p>
<pre><code class="unrealscript">delegate bool CHOnInputDelegateImproved(UIScreen Screen, int iInput, int ActionMask);
function SubscribeToOnInputForScreen(UIScreen Screen, delegate&lt;CHOnInputDelegateImproved&gt; Callback);
function UnsubscribeFromOnInputForScreen(UIScreen Screen, delegate&lt;CHOnInputDelegateImproved&gt; Callback);
</code></pre>

<p>In a nutshell, with <code>SubscribeToOnInputForScreen</code> you ask the UIScreenStack
"when screen <code>Screen</code> would receive input, ask me first".
The <code>CHOnInputDelegateImproved</code> delegate defines the signature of the callback function
called when the targeted screen would receive input.</p>
<p>Your function will be called with three arguments: The screen that would have received the input (<code>Screen</code>),
the button that was pressed (<code>iInput</code>), and the action that occured (<code>ActionMask</code>, button press/release).
The button and action are numeric values that correspond to constants in <code>UIUtilities_Input.uc</code>.
If your function returns true, the ScreenStack will consider the input handled and immediately
stop processing the input event. If your function returns false, the ScreenStack will continue
calling other subscribers and, if unhandled, will finally notify the screen itself.</p>
<p>You can manually unsubscribe from receiving input, but this is generally not necessary
as your callback will only be called when the screen would have received input and
will automatically be unsubscribed upon removal of the targeted screen.</p>
<p>The following simplified example is taken from <a href="https://github.com/WOTCStrategyOverhaul/CovertInfiltration">Covert Infiltration</a>:</p>
<pre><code class="unrealscript">class UIListener_Mission extends UIScreenListener;

event OnInit (UIScreen Screen)
{
    local UIMission MissionScreen;

    MissionScreen = UIMission(Screen);
    if (MissionScreen == none) return;

    // This is a UIMission screen, register
    MissionScreen.Movie.Stack.SubscribeToOnInputForScreen(MissionScreen, OnMissionScreenInput);
}

simulated protected function bool OnMissionScreenInput (UIScreen Screen, int iInput, int ActionMask)
{
    if (!Screen.CheckInputIsReleaseOrDirectionRepeat(iInput, ActionMask))
    {
        return false;
    }

    switch (iInput)
    {
    case class'UIUtilities_Input'.const.FXS_BUTTON_RTRIGGER:
        // The right controller trigger was just released, show custom screen
        // ...
        // Tell the ScreenStack that this input was handled
        return true;
        break;
    }

    return false;
}
</code></pre>

<p><code>CheckInputIsReleaseOrDirectionRepeat</code> ensures that the button was just released (or, if directional button,
held for a long time), making input behavior more consistent with base game screens.</p>
<p>Although all mouse events can be inspected, Flash usually provides its own handlers that run even if
the callback indicates to the ScreenStack that the input was handled. As a result, the only mouse event
that can reliably be stopped with <code>SubscribeToOnInputForScreen</code> is the already navigation-relevant
right click.</p>
<p>This feature is a more convenient version of <a href="./SubscribeToOnInput"><code>SubscribeToOnInput</code></a>, which receives
events for any screen and has to be manually unsubscribed. <code>SubscribeToOnInput</code> offers lower-level
interaction with the input system at the cost of ergonomics.</p>
<h2 id="source-code-references">Source code references</h2>
<ul>
<li><a href="https://github.com/X2CommunityCore/X2WOTCCommunityHighlander/blob/master/X2WOTCCommunityHighlander/Src/XComGame/Classes/UIScreenStack.uc#L843-L919">UIScreenStack.uc:843-919</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../TintMaterialConfigs/" class="btn btn-neutral float-right" title="TintMaterialConfigs">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SubscribeToOnInput/" class="btn btn-neutral" title="SubscribeToOnInput"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/X2CommunityCore/X2WOTCCommunityHighlander" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../SubscribeToOnInput/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../TintMaterialConfigs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
